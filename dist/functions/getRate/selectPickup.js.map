{"version":3,"file":"selectPickup.js","names":["selectPickup","recipientPhone","textMessage","message_id","res","connection","query","err","rows","fields","latest_question","spdAction","Whatsapp","sendSimpleButtons","message","listOfButtons","id","title","map","category","markMessageAsRead","sendStatus","flag","destination_region","pickups","i","length","push","name","Boolean"],"sources":["../../../src/functions/getRate/selectPickup.js"],"sourcesContent":["'use strict';\nimport Whatsapp from '../../config/whatsapp';\nimport connection from '../../config/db';\n\nexport default async function selectPickup(recipientPhone, textMessage, message_id, res) {\n  connection.query(\n    `SELECT latest_question FROM whatsapp_cloud WHERE phone_no = '${recipientPhone}'`,\n    async (err, rows, fields) => {\n      if (err)\n        throw err;\n      const latest_question = rows[0].latest_question;\n\n      if (latest_question === 'select pickup destination') {\n        spdAction(textMessage, recipientPhone);\n\n        // send \"select pickup destination\" + pickup destinations (emoji list)\n        await Whatsapp.sendSimpleButtons({\n          message: `Select the type of container preferred`,\n          recipientPhone: recipientPhone,\n          message_id,\n          listOfButtons: [\n            { id: 20, title: '20ft' },\n            { id: 40, title: '40ft' },\n          ].map((category) => ({\n            title: category.title,\n            id: `container_${category.id}`,\n          })),\n        });\n\n        await Whatsapp.markMessageAsRead({\n          message_id,\n        });\n        return res.sendStatus(200);\n      }\n    }\n  );\n}\n\nfunction spdAction(message, recipientPhone) {\n    let flag = 0;\n\n    connection.query(\n        `SELECT destination_region FROM whatsapp_cloud WHERE phone_no = '${recipientPhone}'`,\n        async (err, rows, fields) => {\n            if (err) throw err;\n\n            connection.query(\n                `SELECT name FROM destinationrates WHERE region_id = '${rows[0].destination_region}'`,\n                async (err, rows, fields) => {\n                    if (err) throw err;\n\n                    let pickups = ['_'];\n\n                    for (let i = 0; i < rows.length; i++) {\n                        pickups.push(rows[i].name);\n                    }\n\n                    connection.query(\n                        `UPDATE whatsapp_cloud SET pickup_destination = '${pickups[message]}' WHERE phone_no = '${recipientPhone}';`,\n                        (err, res, fields) => {\n                            if (err) flag = 1;\n                        }\n                    );\n                }\n            );\n\n            connection.query(\n                `UPDATE whatsapp_cloud SET latest_question = 'select type of container' WHERE phone_no = '${recipientPhone}';`,\n                (err, res, fields) => {\n                    if (err) flag = 1;\n                }\n            );\n        }\n    );\n    return !Boolean(flag);\n}"],"mappings":"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"}