{"version":3,"file":"selectContainerNum.js","names":["selectContainerNum","recipientPhone","textMessage","message_id","res","connection","query","err","rows","fields","latest_question","ncAction","Whatsapp","markMessageAsRead","sendStatus","message","flag","no_of_container","container_type","destination_region","pickup_destination","rate","rate_twenty","sendText","rate_forty","Boolean"],"sources":["../../../src/functions/getRate/selectContainerNum.js"],"sourcesContent":["'use strict';\nimport Whatsapp from '../../config/whatsapp';\nimport connection from '../../config/db';\n\nexport default async function selectContainerNum(recipientPhone, textMessage, message_id, res) {\n  connection.query(\n    `SELECT latest_question FROM whatsapp_cloud WHERE phone_no = '${recipientPhone}'`,\n    async (err, rows, fields) => {\n      if (err)\n        throw err;\n      const latest_question = rows[0].latest_question;\n\n      if (latest_question === 'number of containers') {\n        ncAction(textMessage, recipientPhone);\n\n        await Whatsapp.markMessageAsRead({\n          message_id,\n        });\n        return res.sendStatus(200);\n      }\n    }\n  );\n}\n\nfunction ncAction(message, recipientPhone) {\n  let flag = 0;\n  let no_of_container = message;\n  connection.query(\n      `UPDATE whatsapp_cloud SET no_of_container = '${no_of_container}' WHERE phone_no = '${recipientPhone}';`,\n      (err, res, fields) => {\n          if (err) flag = 1;\n      }\n  );\n\n  connection.query(\n      `UPDATE whatsapp_cloud SET latest_question = 'new' WHERE phone_no = '${recipientPhone}';`,\n      (err, res, fields) => {\n          if (err) flag = 1;\n      }\n  );\n\n  // calc rate\n  connection.query(\n      `SELECT * FROM whatsapp_cloud WHERE phone_no = '${recipientPhone}'`,\n      async (err, rows, fields) => {\n          if (err) throw err;\n          let { container_type } = rows[0];\n          let { destination_region } = rows[0];\n          let { pickup_destination } = rows[0];\n\n          if (container_type === 'container_20') {\n              connection.query(\n                  `SELECT rate_twenty FROM destinationrates WHERE region_id = '${destination_region}' AND name = '${pickup_destination}'`,\n                  async (err, rows, fields) => {\n                      if (err) throw err;\n                      let rate = rows[0].rate_twenty * no_of_container;\n\n                      await Whatsapp.sendText({\n                          recipientPhone: recipientPhone,\n                          message: `The rate is: GHC ${rate}`,\n                      });\n                  }\n              );\n          }\n\n          if (container_type === 'container_40') {\n              connection.query(\n                  `SELECT rate_forty FROM destinationrates WHERE region_id = '${destination_region}' AND name = '${pickup_destination}'`,\n                  async (err, rows, fields) => {\n                      if (err) throw err;\n                      let rate = rows[0].rate_forty * no_of_container;\n\n                      await Whatsapp.sendText({\n                          recipientPhone: recipientPhone,\n                          message: `The rate is: GHC ${rate}`,\n                      });\n                  }\n              );\n          }\n      }\n  );\n\n  return !Boolean(flag);\n}\n"],"mappings":"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"}